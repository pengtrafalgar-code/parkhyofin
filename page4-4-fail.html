<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>공론장을 찾아서 - Page 4-4-fail</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- 공통 CSS 파일 연결 -->
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(to bottom, #0a0a0f, #1a1a2e);
      color: #e0e0e0;
      font-family: "Cinzel", serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: relative;
      padding: 20px;
      overflow: hidden;
    }

    img {
      max-width: 30%;
      height: auto;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px #6a0dad, 0 0 30px #3c096c;
      position: relative;
      z-index: 1;
    }

    p {
      max-width: 650px;
      font-size: 18px;
      line-height: 1.6;
      color: #ccc;
      margin: 5px 0 15px 0;
      position: relative;
      z-index: 1;
    }

    .highlight {
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 1px #fff, 0 0 10px #fff;
    }

    button {
      background: #6a0dad;
      color: #fff;
      padding: 12px 28px;
      font-size: 18px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 0 15px #6a0dad, 0 0 30px #3c096c;
      transition: 0.3s;
      position: relative;
      z-index: 1;
    }
    button:hover {
      background: #9d4edd;
      box-shadow: 0 0 20px #9d4edd, 0 0 40px #c77dff;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url("배경.png") repeat;
      opacity: 0.2;
      animation: fogMove 60s linear infinite;
      z-index: 0;
    }

    @keyframes fogMove {
      from { background-position: 0 0; }
      to { background-position: 2000px 0; }
    }
  </style>
</head>
<body>
  <img src="마지막 문.png" alt="마지막 문">

  <p>
    당신의 선택으로 <span class="highlight">공론장의 문이 닫혔습니다.</span><br>
    마지막 관문이 끝났습니다. 바뀐 세상을 확인하세요.
  </p>

  <button onclick="goNext()">결과 확인하기</button>

  <script>
    // ---------- ✅ fail 기록 로직 ----------
    (function() {
      // 현재 failCount 불러오기 (없으면 0으로 초기화)
      let fails = parseInt(localStorage.getItem("failCount"));
      if (isNaN(fails)) fails = 0;

      // 이 페이지 방문 여부 확인 (중복 방지)
      const marked = localStorage.getItem("page4_4_marked");

      // 처음 방문이면 failCount +1
      if (!marked) {
        fails++;
        localStorage.setItem("failCount", String(fails));
        localStorage.setItem("page4_4_marked", "true");
      }
    })();
    // -------------------------------------

    function goNext() {
      const failCount = Number(localStorage.getItem('failCount')) || 0;
      console.log("현재 failCount:", failCount); // 디버깅용

      // ✅ failCount 값에 따라 엔딩 페이지로 이동
      if (failCount >= 3) {
        window.location.href = "page-ending4.html";  // 실패 3~4회
      } else if (failCount === 2) {
        window.location.href = "page-ending3.html";  // 실패 2회
      } else if (failCount === 1) {
        window.location.href = "page-ending2.html";  // 실패 1회
      } else {
        window.location.href = "page-ending1.html";  // 실패 0회
      }
    }
  </script>
</body>
</html>
